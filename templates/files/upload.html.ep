%# /templates/files/upload.html.ep

% layout 'default';
% title 'üì§ Upload File';

% content_for 'head' => begin
    <link rel="stylesheet" href="/css/files.css">
    <script defer src="/js/files.js"></script>
% end

<div class="admin-container">
    <h1>üì§ Upload New File</h1>

    <div class="edit-container">
        <form method="POST" action="/files" enctype="multipart/form-data" id="uploadForm" class="edit-form">
            <div class="form-group">
                <label for="file">Choose File (Max 1GB)</label>
                <div class="file-drop-zone" id="dropZone">
                    <input type="file" id="file" name="file" required>
                    <p class="drop-text">üìÅ Drag & drop file here or click to browse</p>
                    <p class="file-name" id="fileName"></p>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Description (Optional)</label>
                <textarea id="description" name="description" rows="3" placeholder="Add a description for this file..."></textarea>
            </div>

            <div class="form-group checkbox-group">
                <label for="admin_only">
                    <input type="checkbox" name="admin_only" id="admin_only">
                    üîí Admin Only Access
                </label>
            </div>

            <div class="form-group" id="userAccessGroup">
                <label>Limit Access to Specific Users (Optional)</label>
                <select name="allowed_users" multiple size="5" id="allowedUsers">
                    <% for my $user (@{stash('users')}) { %>
                        <% if ($user->{status} eq 'approved') { %>
                            <option value="<%= $user->{username} %>"><%= $user->{username} %></option>
                        <% } %>
                    <% } %>
                </select>
                <small>Hold Ctrl/Cmd to select multiple users. Leave empty for public access.</small>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-save">üì§ Upload File</button>
                <a href="/files" class="btn btn-cancel">Cancel</a>
            </div>
        </form>
    </div>
</div>
